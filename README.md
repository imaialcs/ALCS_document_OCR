# ALCS文書OCR

## 概要

「ALCS文書OCR」は、会計事務所やバックオフィス業務の効率化を目的としたデスクトップアプリケーションです。
画像やPDF形式の書類をGoogle Gemini APIを利用して高精度にOCR処理し、編集可能なデータに変換します。

## 主な機能

- **多様なファイル形式に対応:** PNG, JPG, PDF形式のファイルを複数同時にアップロードできます。
- **帳票種別の動的選択:** タイムカード、領収書、日計表など、読み取る帳票の種類を選択することで、項目に合わせて最適化されたOCR処理を実行します。
- **高精度OCR:** Google Gemini APIを利用し、勤怠管理表や請求書などの複雑なフォーマットから情報を抽出します。
- **データ検証機能（セルフチェック）:** AIの抽出結果に、日付形式の異常や計算ミス、必須項目の漏れがないか自動でチェックし、問題がある箇所をUI上で警告します。
- **ローカル画像前処理:** APIに画像を送信する前に、ローカルで画像の最適化（リサイズ、トリミング、コントラスト調整）を行い、認識精度と処理速度を向上させます。
- **高機能なデータ編集:**
    - **列の表示/非表示:** 結果テーブルの上部にあるチェックボックスを操作して、不要な列を非表示にし、表示をカスタマイズできます。
    - **画像と結果の並列表示:** 読み取り元の画像と、データ化された表を左右に並べて表示することで、内容の確認と修正がより効率的に行えます。
    - 認識結果の表は、スプレッドシートのように直感的に操作できます。
    - 右クリックメニューから、行や列の挿入・削除、コピー、カット、貼り付けが可能です。
    - ドラッグ＆ドロップによる行・列の移動にも対応しています。
- **Excelエクスポート:**
    - 認識結果を新しいExcelファイル(.xlsx/.xlsm)としてダウンロード。
    - 既存のExcelテンプレートにデータを転記。
- **氏名自動補正:** 社員名簿などを利用して、OCRが読み取った氏名を自動で補正し、精度を向上させます。
- **自動アップデート:** アプリケーションは起動時に新しいバージョンを自動で確認し、更新します。

## 動作環境

- Windows

## インストールと使い方

1.  [GitHubリリースページ](https://github.com/imaialcs/ALCS_document_OCR/releases)から最新版のインストーラー (`ALCS文書OCR-Setup-X.X.X.exe`) をダウンロードします。
2.  ダウンロードしたインストーラーを実行し、画面の指示に従ってインストールします。
3.  アプリケーションを起動し、ファイルをドラッグ＆ドロップしてOCR処理を開始します。

## 変更履歴

## v1.2.0 (2025-10-01)

### 新機能:
- **帳票種別選択機能:**
  - タイムカード、領収書、日計表など、読み取る帳票の種類をドロップダウンから選択できるようになりました。
  - 選択した種類に応じて、AIへの指示（プロンプト）が動的に最適化され、より高精度なデータ抽出が可能になりました。
- **データ検証機能（セルフチェック）:**
  - AIの抽出結果をアプリケーションが自動で検証する機能を追加しました。
  - 日付の形式、合計金額の計算、必須項目の有無などをチェックし、問題があるセルを赤くハイライトしてユーザーに知らせます。
- **表示列カスタマイズ機能:**
  - 結果テーブルの各列について、表示/非表示を切り替えられるチェックボックスを追加しました。
  - これにより、ユーザーは必要な情報だけを画面に表示できます。

### 修正:
- 汎用テーブル形式のOCR処理において、表内の空欄が無視されてデータが詰められてしまう問題を修正しました。空のセルは空文字列として正しく保持されます。
- 開発中のテストで発生したReactコンポーネントのインポート漏れに関するエラーを修正しました。

## v1.1.6 (2025-09-30)

### 機能改善:
- **複数ページPDFのOCR結果表示改善**: 複数ページのPDFファイルをOCR処理した際、各OCR結果が対応するPDFページの画像と正確に紐付けられ、スプレッドシートの横に表示されるようになりました。これにより、OCR結果の確認と修正がより直感的かつ効率的に行えるようになります。

## v1.1.5 (2025-09-30)

### バグ修正:
- Gemini APIからの応答がJSON形式でない場合に発生していた `Unexpected token` エラーを修正し、応答のパース処理を堅牢化しました。
- 処理結果のデータ構造が不正な場合に発生していた `TypeError: Cannot read properties of undefined (reading 'length')` エラーを修正しました。

### 機能改善:
- Gemini APIへのプロンプトを短縮し、OCRの精度を維持したままトークン消費量を削減しました。
- ログファイルから冗長なデバッグ情報を削除し、ログファイルの肥大化を防止しました。
- 処理完了後、画面上にAPIトークン使用量（入力・出力）が表示されるようになりました。
- ログファイルに1ページごとの詳細なトークン使用量が記録されるようになりました。

## v1.1.4 (2025-09-29)

### 機能改善:
- **UI/UX改善:** OCRの認識結果を、読み取り元画像と横並びで表示するようにレイアウトを全面的に刷新しました。これにより、元の書類とデータを見比べながらの確認・修正作業が格段に行いやすくなりました。

## v1.1.3 (2025-09-25)

### 機能改善:
- スプレッドシートの右クリックメニューに「貼り付け」機能を追加しました。
- スプレッドシートの右クリックメニューから、選択範囲に応じて複数行/列を挿入できるようになりました（Excelと同様の動作）。
- スプレッドシートの行挿入時に意図せず2行挿入される不具合を修正しました。
- Handsontableのテーマを非推奨のクラシックテーマからモダンな「light」テーマに更新し、関連するCSSインポートエラーを修正しました。

### バグ修正:
- TypeScriptの型定義に関するエラーを修正しました。

### その他:
- すべてのnpmパッケージを最新の互換バージョンに更新しました。

### 既知の問題:
- 「xlsx」パッケージの高深刻度脆弱性（プロトタイプ汚染とReDoS）は、現在修正が利用できないため、依然として残っています。

### v1.1.2 (2025-09-25)

- **機能追加:** 画像の前処理機能をローカルで実行するハイブリッド構成を実装しました。
    - API送信前に、画像の最適化（リサイズ）、余白の自動トリミング、コントラストの自動調整を行います。
    - これにより、OCR精度と処理速度の向上が期待できます。
    - 各前処理はオプション画面でON/OFFの切り替えが可能です。
- **アーキテクチャ変更:** Node.js固有の画像処理ライブラリ(`jimp`)を、Electronのメインプロセスで実行し、IPC通信でレンダラープロセスと連携するよう修正しました。これにより、アプリケーションの安定性が向上しました。
- **UI修正:** オプション設定のUIレイアウトを改善し、アイコン表示を修正しました。

## 開発者向け情報

### 主要な技術スタック

- [Electron](https://www.electronjs.org/)
- [React](https://reactjs.org/)
- [TypeScript](https://www.typescriptlang.org/)
- [Vite](https://vitejs.dev/)
- [Tailwind CSS](https://tailwindcss.com/)
- [Google Gemini API](https://ai.google.dev/)
- [Python](https://www.python.org/) (Excelテンプレートへの転記処理)

### ビルド方法

```bash
# 依存関係をインストール
npm install

# 開発環境の起動 (単一のターミナルで実行)
npm run dev

# アプリケーションをビルド（Windows向け）
npm run dist
```
ビルドされたファイルは`build_output`ディレクトリに出力されます。

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 作者

- alcs